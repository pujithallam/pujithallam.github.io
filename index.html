<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="project-page-title">Project Details</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts - Inter for clean typography -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8f8f8; /* Light background */
            color: #333; /* Dark text for contrast */
            line-height: 1.6;
        }
        .container {
            max-width: 1024px; /* Limit content width */
        }
        .section-header {
            font-weight: 700;
            color: #2c3e50;
            text-align: center;
            margin-bottom: 2rem;
            position: relative;
            padding-bottom: 10px;
        }
        .section-header::after {
            content: '';
            position: absolute;
            left: 50%;
            bottom: 0;
            transform: translateX(-50%);
            width: 60px;
            height: 4px;
            background-color: #2563eb;
            border-radius: 2px;
        }
        .pdf-viewer-container {
            width: 100%;
            height: 80vh; /* Adjust height as needed for PDF viewer */
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            overflow: hidden; /* Hide scrollbars if PDF is larger than iframe */
        }
        .pdf-viewer-container iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
        /* Loading spinner styles */
        .loading-spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-top: 4px solid #2563eb;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="antialiased bg-gray-50">

    <!-- Navigation Bar (Simple version for project page) -->
    <nav class="bg-white shadow-md p-4 sticky top-0 z-50">
        <div class="container mx-auto flex justify-between items-center">
            <a href="index.html" class="text-3xl font-extrabold text-gray-800 tracking-tight">Pujith Sai Eswar Allam</a>
            <a href="index.html" class="text-blue-600 hover:text-blue-800 transition duration-300 flex items-center">
                <svg class="w-5 h-5 mr-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 18l-6-6 6-6"/></svg>
                Back to Portfolio
            </a>
        </div>
    </nav>

    <main class="container mx-auto px-4 py-12 md:py-16">
        <section class="bg-white p-8 rounded-lg shadow-lg mb-8">
            <h1 class="text-4xl md:text-5xl font-extrabold text-gray-900 mb-4 text-center" id="project-title"></h1>
            <p class="text-lg text-gray-700 mb-6 text-center" id="project-time"></p>

            <div class="mb-8 flex flex-wrap gap-2 justify-center" id="project-skills">
                <!-- Skills labels will be inserted here by JavaScript -->
            </div>

            <img id="project-image" src="" alt="Project Image" class="w-full h-auto rounded-lg shadow-md mb-8 object-cover max-h-[400px]">

            <div class="text-base text-gray-800 mb-8 leading-relaxed" id="project-description">
                <!-- Project description will be inserted here by JavaScript -->
            </div>

            <h2 class="text-3xl font-bold text-gray-800 section-header mb-6">Project Report</h2>
            <div class="pdf-viewer-container">
                <div class="loading-spinner" id="pdf-loading-spinner"></div>
                <iframe id="project-report-pdf" src="" type="application/pdf" width="100%" height="100%" loading="lazy">
                    <p class="text-red-500 text-center p-4">Your browser does not support PDFs. You can <a id="pdf-download-link" href="#" class="text-blue-600 hover:underline" download>download the PDF here</a> instead.</p>
                </iframe>
            </div>
        </section>
    </main>

    <!-- Footer (Simple version for project page) -->
    <footer class="bg-gray-900 py-8 text-center text-gray-400 text-sm">
        <p>&copy; 2025 Pujith Sai Eswar Allam. All rights reserved.</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const projectId = parseInt(urlParams.get('id'));

            // Retrieve projectsData from localStorage
            const storedProjectsData = localStorage.getItem('projectsData');
            const projectsData = storedProjectsData ? JSON.parse(storedProjectsData) : [];

            const project = projectsData.find(p => p.id === projectId);

            if (project) {
                document.getElementById('project-page-title').textContent = project.title + " - Project Details";
                document.getElementById('project-title').textContent = project.title;
                document.getElementById('project-time').textContent = "Completed: " + project.time;
                document.getElementById('project-image').src = project.imageUrl;
                document.getElementById('project-image').alt = project.title; // Update alt text
                document.getElementById('project-description').textContent = project.description;

                const skillsContainer = document.getElementById('project-skills');
                skillsContainer.innerHTML = ''; // Clear existing content
                project.skills.forEach(skill => {
                    const span = document.createElement('span');
                    span.className = 'bg-blue-100 text-blue-700 text-sm px-3 py-1 rounded-full font-medium';
                    span.textContent = skill;
                    skillsContainer.appendChild(span);
                });

                const pdfViewer = document.getElementById('project-report-pdf');
                const pdfLoadingSpinner = document.getElementById('pdf-loading-spinner');
                const pdfDownloadLink = document.getElementById('pdf-download-link');

                if (project.reportPdfUrl) {
                    // Show spinner while PDF loads
                    pdfLoadingSpinner.style.display = 'block';
                    pdfViewer.style.display = 'none'; // Hide iframe until loaded
                    
                    pdfViewer.src = project.reportPdfUrl;
                    pdfDownloadLink.href = project.reportPdfUrl;

                    pdfViewer.onload = function() {
                        pdfLoadingSpinner.style.display = 'none'; // Hide spinner
                        pdfViewer.style.display = 'block'; // Show iframe
                    };
                    pdfViewer.onerror = function() {
                        pdfLoadingSpinner.style.display = 'none'; // Hide spinner
                        console.error("Failed to load PDF from URL:", project.reportPdfUrl);
                        // Optionally display a user-friendly error message within the iframe area
                        const errorMessage = document.createElement('p');
                        errorMessage.className = 'text-red-500 text-center p-4';
                        errorMessage.textContent = 'Failed to load PDF. Please check the link or try downloading.';
                        pdfViewer.parentNode.appendChild(errorMessage);
                    };

                } else {
                    pdfLoadingSpinner.style.display = 'none';
                    pdfViewer.style.display = 'none'; // Hide iframe if no PDF URL
                    const noPdfMessage = document.createElement('p');
                    noPdfMessage.className = 'text-gray-500 text-center p-4';
                    noPdfMessage.textContent = 'No project report available for this project.';
                    pdfViewer.parentNode.appendChild(noPdfMessage);
                }

            } else {
                document.getElementById('project-page-title').textContent = "Project Not Found";
                document.querySelector('main').innerHTML = '<h1 class="text-4xl text-center text-red-600 mt-16">Project Not Found</h1><p class="text-center text-lg text-gray-700 mt-4">The project you are looking for does not exist.</p><div class="text-center mt-8"><a href="index.html" class="text-blue-600 hover:text-blue-800 font-semibold">Back to Portfolio</a></div>';
            }
        });
    </script>
</body>
</html>
